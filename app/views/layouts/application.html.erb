<!DOCTYPE html>
<html>
	<head>
		<title><% if current_page?('/') %>The Spain Report | Understand Spain, In English<% else %><%= yield(:title) %> | The Spain Report<% end %></title>
		<%= yield(:meta) %>
		<%= favicon_link_tag %>
		<%= stylesheet_link_tag "https://fonts.googleapis.com/css?family=Anton:400", media: "all" %>
		<%= csrf_meta_tags %>
		<%= csp_meta_tag %>
		<%= stylesheet_link_tag    'application', media: 'all'%>
		<%= javascript_include_tag 'application' %>
		
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="alternate" type="application/rss+xml" title="The Spain Report: English + Spanish" href="<%= root_url + 'rss' %>" />
		<link rel="alternate" type="application/rss+xml" title="The Spain Report: in English" href="<%= root_url + 'rss/eng' %>" />
		<link rel="alternate" type="application/rss+xml" title="The Spain Report: en espaÃ±ol" href="<%= root_url + 'rss/es' %>" />
		
		<script src="//js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
		<script type="text/javascript">
			var onSuccess = function(x){
				var country_code = x.country.iso_code;
				var ip = x.traits.ip_address;
				var country_name = x.country.names.en;
			  	var country_flags = {};
					<% Country.all.each do |c| %>
						country_flags["<%= c.country_code %>"] = {image: '<%= asset_path(c.country_code + '.jpg') %>', tax_percent: <%= c.tax_percent %>}
					<% end %>

				document.getElementById('ip_address').value = ip;
				document.getElementById('ip_country_code').value = country_code;
				document.getElementById('ip_country_name').value = country_name;
				document.getElementById('vat').innerHTML = country_flags[country_code].tax_percent.toFixed(1) + "%";
				document.getElementById('purchase_ip').innerHTML = ip;
				document.getElementById('country_flag').src = country_flags[country_code].image;
			};
			
			var onError = function(error){
			  alert(
			      "Error:\n\n"
			      + JSON.stringify(error, undefined, 4)
			  );
			};
			
			geoip2.country(onSuccess, onError);
		</script>
	
	</head>

	<body>
		<input type="hidden" name="ip_country_code" id="ip_country_code" value="">
		<input type="hidden" name="ip_address" id="ip_address" value="">
		<input type="hidden" name="ip_country_name" id="ip_country_name" value="">
		
		<%= yield %>
	</body>

</html>